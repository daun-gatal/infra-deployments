stages:
  - plan
  - apply

include:
  - local: 'database/.gitlab-ci.yml'
  - local: 'minio/.gitlab-ci.yml'
  - local: 'kafka/.gitlab-ci.yml'
  - local: 'spark/.gitlab-ci.yml'
  - local: 'nessie/.gitlab-ci.yml'

before_script:
  - source .env
  - export $(grep -v '^#' .env | cut -d= -f1)
  - apt-get update && apt-get install -y curl openssh-client gettext-base
  - curl -fsSL https://tailscale.com/install.sh | sh
  - nohup tailscaled &
  - sleep 5
  - tailscale up --auth-key="${TAILSCALE_AUTH_KEY}?preauthorized=true" --advertise-tags=${TAILSCALE_TAG} --hostname=${TAILSCALE_HOSTNAME}
  - echo "âœ… Connected to Tailscale"

# Add comments to the jobs below as needed